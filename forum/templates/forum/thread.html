{% extends "layout/default.html" %}

{% load static %}
{% load user_filters %}
{% load crispy_forms_tags %}

{% block content %}
	<div class="container">
		<nav aria-label="breadcrumb">
			<ol class="breadcrumb">
				<li class="breadcrumb-item"><a href="{% url 'home-index' %}">Home</a></li>
				<li class="breadcrumb-item"><a href="{% url 'forum-index' %}">Forums</a></li>
				<li class="breadcrumb-item"><a href="{% url 'forum-subcategory' subcategory_name=thread.subcategory.title %}">{{ thread.subcategory.title }}</a></li>
				<li class="breadcrumb-item active" aria-current="page">{{ thread.title }}</li>
			</ol>
		</nav>
		<h3>{{ thread.title }}</h3>
		{% for message in thread.get_messages %}
			<div class="card" {% if forloop.counter0 == 0 %}style="background: var(--background-gray);"{% endif %}>
				<div class="card-body">
					<div class="row">
						<div class="col-6 col-md-3 center">
							<img src="{{ message.author|avatar }}" class="img-fluid avatar" alt="{{ message.author.username }}'s avatar"><br>
                            <h5><a href="{% url "accounts-profile" username=message.author.username %}">{{ message.author }}</a></h5>
							{% for group in message.author.groups.all %}
								{% if forloop.counter == 1 %}{% endif %}
								<h6><span class="badge badge-primary">{{ group }}</span></h6>
							{% endfor %}
						</div>
						<div class="col-6 col-md-9">
							<p>{{ message.content|safe }}</p>
							<hr>
							<small>{{ message.author }}, posted on {{ message.date_posted }} {% if message.date_edited is not null %}(last edited: {{ message.date_edited }}){% endif %}
                                {% if message.author == request.user %}[ <a href="{% url 'forum-message-edit' message_id=message.pk %}">Edit</a> ] [ <a href="{% url 'forum-message-remove' message_id=message.pk %}">Remove</a> ]{% endif %}
                                <span style="float: right">
                                    <a href="{% url 'forum-message-upvote' message_id=message.id %}" class="text-success {% if message.is_upvoter %}transparent{% endif %}">{{ message.upvoters.count }} <i class="fas fa-chevron-up"></i></a>
                                    <a href="{% url 'forum-message-downvote' message_id=message.id %}" class="text-danger {% if message.is_downvoter %}transparent{% endif %}">{{ message.downvoters.count }} <i class="fas fa-chevron-down"></i></a>
                                </span>
                            </small>
                        </div>
					</div>
				</div>
			</div>
		{% endfor %}
		{% if user.is_authenticated %}
			<div class="card">
				<div class="card-body">
					<form action="{% url 'forum-thread-reply' thread_title=thread.title %}" method="post">
						{% csrf_token %}
						{{ form|crispy }}
						<button class="btn btn-primary" type="submit">Reply</button>
					</form>
				</div>
			</div>
		{% else %}
			<div class="card">
				<div class="card-body">
					You need to be logged in in order to post a message.
				</div>
			</div>
		{% endif %}
	</div>
{% endblock %}